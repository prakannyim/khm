<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KHM Voice ‚Äì KHM TV Journal</title>
<meta name="description" content="KHM Voice ‚Äì Voix Khmer, journal TV, podcast et contenus √©ducatifs multilingues.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#2C6E49">
<meta name="mobile-web-app-capable" content="yes">

<style>
html, body { height: 100%; }
body { margin:0; overflow:hidden; background:#0f1a16; color:#fff; font-family: Arial, sans-serif; }

.tv{
  height:100vh;
  display:grid;
  grid-template-rows: auto auto 1fr auto; /* header, info-bar, video, controls */
}

/* Header image */
.tv-header {
  padding: 8px 12px;
  min-height: 64px;
  background:
    linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.35)),
    url("assets/khmvoice_img.png") center/cover no-repeat;
  display: flex;
  align-items: flex-end;
  justify-content: center;
}
.tv-title {
  background: rgba(0,0,0,.45);
  padding: 10px 18px;
  border-radius: 10px;
  font-size: 28px;
  letter-spacing: 1px;
  white-space: nowrap;
}

/* Video area */
.tv-main {
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 12px;
}
.video-box{
  width: min(980px, 96vw);
  aspect-ratio: 16 / 9;
  border-radius: 16px;
  overflow:hidden;
  box-shadow: 0 12px 36px rgba(0,0,0,.35);
  background:#000;
}
.video-box iframe{ width:100%; height:100%; border:0; }

/* Controls (big buttons) */
.tv-controls{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  padding: 16px;
  background: rgba(255,255,255,.04);
  border-top: 1px solid rgba(255,255,255,.12);
}

.btn{
  font-size: 22px;
  padding: 18px 16px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  color:#fff;
  text-decoration:none;
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
}

.btn:active { transform: scale(0.99); }

select{
  font-size: 20px;
  padding: 16px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.25);
  color:#fff;
  width: 100%;
}

/* Landscape low height: compact a bit but still no scroll */
@media (max-height: 520px){
  .tv { grid-template-rows: 110px 1fr 120px; }
  .tv-title { font-size: 22px; }
  .btn { font-size: 18px; padding: 14px 12px; }
  select { font-size: 18px; padding: 14px 12px; }
}
/* Landscape / petite hauteur : compacter pour ne rien couper */
@media (max-height: 520px) {
  .tv {
    grid-template-rows: 90px 1fr 96px; /* header / video / controls */
  }

  .tv-header { padding: 10px; }
  .tv-title  { font-size: 20px; padding: 6px 12px; }

  .tv-controls { padding: 10px; gap: 10px; }
  .btn { font-size: 16px; padding: 12px 10px; border-radius: 14px; }
  select { font-size: 16px; padding: 12px 10px; border-radius: 14px; }

  .video-box{
    width: min(860px, 96vw);
    /* la hauteur r√©elle doit tenir dans l'√©cran */
    max-height: calc(100vh - 90px - 96px - 24px);
  }
}
@media (max-height: 680px) and (min-height: 521px) {
  .tv { grid-template-rows: 110px 1fr 110px; }
  .btn { font-size: 18px; padding: 14px 12px; }
  select { font-size: 18px; padding: 14px 12px; }
  .video-box{ max-height: calc(100vh - 110px - 110px - 24px); }
}
@media (max-height: 420px) {
  body { overflow-y: auto; }   /* seulement tr√®s petit */
  .tv  { height: auto; }
}
/* Landscape / petite hauteur : gagner de la place en bas */
@media (max-height: 520px) {

  /* Header : un peu plus bas mais visible en entier */
  .tv-header {
    height: auto;
    padding: 8px;
  }

  .tv-title {
    font-size: 18px;
    padding: 6px 10px;
  }

  /* Boutons plus compacts */
  .tv-controls {
    padding: 8px;
    gap: 8px;
  }

  .btn {
    font-size: 15px;        /* ‚Üì taille texte */
    padding: 10px 8px;      /* ‚Üì hauteur bouton */
    border-radius: 12px;
  }

  select {
    font-size: 15px;
    padding: 10px 8px;
    border-radius: 12px;
  }

  /* Vid√©o : s'adapte sans pousser le header */
  .video-box {
    max-height: calc(100vh - 80px - 84px - 20px);
  }
}
/* --- Info bar sous l'ent√™te --- */
.info-bar{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 14px;
  background: rgba(255,255,255,.06);
  border-bottom: 1px solid rgba(255,255,255,.12);
}
.info-logo{ height:34px; width:auto; }
.info-name{ font-weight:bold; letter-spacing:.6px; }
.info-sub{ font-size:13px; opacity:.85; }

/* --- Portrait: ent√™te r√©duit d‚Äô1/3 --- */
@media (orientation: portrait) {
  .tv { grid-template-rows: auto auto 1fr auto; }

  /* Avant: min-height ~300px ‚Üí maintenant ~200px */
  .tv-header{
    min-height: 200px;   /* ‚âà -33% */
    padding: 14px;
  }

  .tv-title{
    font-size: 26px;     /* l√©g√®rement plus compact */
    padding: 8px 14px;
  }
}

/* ===== LANDSCAPE : ajustement TV senior ===== */
@media (orientation: landscape) {

  /* Grille : header + info + video + controls */
  .tv{
    grid-template-rows: auto auto 1fr auto;
  }

  /* 1) ENT√äTE +20% */
  .tv-header{
    min-height: 156px;     /* ex: 130px ‚Üí +20% ‚âà 156px */
    padding: 12px;
  }

  .tv-title{
    font-size: 22px;
    padding: 8px 14px;
  }

  /* 2) ZONE VID√âO ‚àí30% */
  .video-box{
    width: min(900px, 94vw);
    aspect-ratio: 16 / 9;

    /* on limite volontairement la hauteur */
    max-height: calc((100vh - 156px - 60px - 96px) * 0.70);
    /*        √©cran - header - info-bar - boutons   ‚Üí -30% */
  }

  /* 3) BOUTONS : priorit√© visibilit√© */
  .tv-controls{
    padding: 10px;
    gap: 10px;
  }

  .btn{
    font-size: 16px;
    padding: 12px 10px;
    border-radius: 14px;
  }

  select{
    font-size: 16px;
    padding: 12px 10px;
    border-radius: 14px;
  }
}

/* S√©curit√©: jamais de scroll sur la page TV */
html, body { height: 100%; }
body { overflow: hidden; }

</style>
</head>

<body>
<div class="tv">
  <header class="tv-header">
    <div class="tv-title" id="pageTitle">KHM TV Journal</div>
  </header>
<div class="info-bar">
  <img src="assets/logo-khmvoice.png" alt="KHM Voice" class="info-logo">
  <div class="info-text">
    <div class="info-name">KHM Voice</div>
    <div class="info-sub">Information ‚Äî filled by ChatGPT</div>
  </div>
</div>

  <main class="tv-main">
    <div class="video-box">
      <iframe id="ytFrame"
        src=""
        title="KHM TV Journal"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen></iframe>
    </div>
  </main>

  <footer class="tv-controls">
    <!-- Langue -->
    <select id="langSel" aria-label="Choisir la langue">
      <option value="fr">Fran√ßais</option>
      <option value="en">English</option>
      <option value="kh">·ûÅ·üí·ûò·üÇ·ûö</option>
    </select>

    <!-- Archives -->
    <a class="btn" id="journalLink" href="journal.html?lang=fr">üìö Archives</a>

    <!-- Plein √©cran / installer -->
    <button class="btn" id="installBtn" type="button">‚¨áÔ∏è Installer</button>
  </footer>
</div>
<script>
document.getElementById("year").textContent = new Date().getFullYear();
</script>
<script>
(function(){
  // IDs YouTube (exemples)
  const VIDEO_ID = {
    fr: "3sDCmdSmtI4",
    en: "3sDCmdSmtI4",
    kh: "3sDCmdSmtI4"
  };

  const TITLES = {
    fr: "KHM TV Journal",
    en: "KHM TV Journal",
    kh: "KHM TV Journal"
  };

  const sel = document.getElementById("langSel");
  const frame = document.getElementById("ytFrame");
  const journalLink = document.getElementById("journalLink");
  const pageTitle = document.getElementById("pageTitle");

  const params = new URLSearchParams(location.search);
  const lang = params.get("lang") || localStorage.getItem("khm_lang") || "fr";
  const safeLang = (lang === "fr" || lang === "en" || lang === "kh") ? lang : "fr";

  function applyLang(v){
    localStorage.setItem("khm_lang", v);
    sel.value = v;
    pageTitle.textContent = TITLES[v];
    const id = VIDEO_ID[v];
    frame.src = "https://www.youtube-nocookie.com/embed/" + id + "?rel=0";
    journalLink.href = "journal.html?lang=" + v;
  }

  applyLang(safeLang);

  sel.addEventListener("change", () => {
    applyLang(sel.value);
    // Met √† jour l'URL sans recharger (propre)
    const u = new URL(location.href);
    u.searchParams.set("lang", sel.value);
    history.replaceState({}, "", u.toString());
  });

  // Bouton "Installer" (Android Chrome)
  let deferredPrompt = null;
  const installBtn = document.getElementById("installBtn");
  installBtn.style.display = "none";

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = "flex";
  });

  installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) {
      alert("Sur Android: menu ‚ãÆ ‚Üí ‚ÄúAjouter √† l‚Äô√©cran d‚Äôaccueil‚Äù.");
      return;
    }
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.style.display = "none";
  });
})();
</script>
<script>
  const sel = document.getElementById("langSel");
  const frame = document.getElementById("ytFrame");
  const journalLink = document.getElementById("journalLink");

  // 2) D√©terminer la langue (URL > localStorage > d√©faut)
  const params = new URLSearchParams(location.search);
  const lang = params.get("lang") || localStorage.getItem("khm_lang") || "fr";
  const safeLang = (lang === "fr" || lang === "en" || lang === "kh") ? lang : "fr";

  sel.value = safeLang;
  localStorage.setItem("khm_lang", safeLang);

  // 3) Appliquer l'iframe + le lien Journal
  const id = VIDEO_ID[safeLang];
  frame.src = "https://www.youtube-nocookie.com/embed/" + id + "?rel=0";
  journalLink.href = "journal.html?lang=" + safeLang;

  // 4) Changement de langue
  sel.addEventListener("change", () => {
    const v = sel.value;
    localStorage.setItem("khm_lang", v);
    location.search = "?lang=" + v; // recharge la page avec la langue
  });
</script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/service-worker.js");
  }
</script>

</body>
</html>
