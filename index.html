<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KHM Voice ‚Äì KHM TV Journal</title>
<meta name="description" content="KHM Voice ‚Äì Voix Khmer, journal TV, podcast et contenus √©ducatifs multilingues.">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#2C6E49">
<meta name="mobile-web-app-capable" content="yes">

<style>
html, body { height: 100%; }
body { margin:0; overflow:hidden; background:#0f1a16; color:#fff; font-family: Arial, sans-serif; }

.tv {
  height: 100%;
  display: grid;
  grid-template-rows: 140px 1fr 140px; /* header / video / controls */
}

/* Header image */
.tv-header {
  background: linear-gradient(rgba(0,0,0,.35), rgba(0,0,0,.35)),
              url("assets/khmvoice_img.png") center/cover no-repeat;
  display:flex; align-items:flex-end; justify-content:center;
  padding: 18px;
}
.tv-title {
  background: rgba(0,0,0,.45);
  padding: 10px 18px;
  border-radius: 10px;
  font-size: 28px;
  letter-spacing: 1px;
  white-space: nowrap;
}

/* Video area */
.tv-main {
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 12px;
}
.video-box{
  width: min(980px, 96vw);
  aspect-ratio: 16 / 9;
  border-radius: 16px;
  overflow:hidden;
  box-shadow: 0 12px 36px rgba(0,0,0,.35);
  background:#000;
}
.video-box iframe{ width:100%; height:100%; border:0; }

/* Controls (big buttons) */
.tv-controls{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  padding: 16px;
  background: rgba(255,255,255,.04);
  border-top: 1px solid rgba(255,255,255,.12);
}

.btn{
  font-size: 22px;
  padding: 18px 16px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  color:#fff;
  text-decoration:none;
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
}

.btn:active { transform: scale(0.99); }

select{
  font-size: 20px;
  padding: 16px 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.25);
  color:#fff;
  width: 100%;
}

/* Landscape low height: compact a bit but still no scroll */
@media (max-height: 520px){
  .tv { grid-template-rows: 110px 1fr 120px; }
  .tv-title { font-size: 22px; }
  .btn { font-size: 18px; padding: 14px 12px; }
  select { font-size: 18px; padding: 14px 12px; }
}
</style>
</head>

<body>
<div class="tv">
  <header class="tv-header">
    <div class="tv-title" id="pageTitle">KHM TV Journal</div>
  </header>

  <main class="tv-main">
    <div class="video-box">
      <iframe id="ytFrame"
        src=""
        title="KHM TV Journal"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen></iframe>
    </div>
  </main>

  <footer class="tv-controls">
    <!-- Langue -->
    <select id="langSel" aria-label="Choisir la langue">
      <option value="fr">Fran√ßais</option>
      <option value="en">English</option>
      <option value="kh">·ûÅ·üí·ûò·üÇ·ûö</option>
    </select>

    <!-- Archives -->
    <a class="btn" id="journalLink" href="journal.html?lang=fr">üìö Archives</a>

    <!-- Plein √©cran / installer -->
    <button class="btn" id="installBtn" type="button">‚¨áÔ∏è Installer</button>
  </footer>
</div>
<script>
document.getElementById("year").textContent = new Date().getFullYear();
</script>
<script>
(function(){
  // IDs YouTube (exemples)
  const VIDEO_ID = {
    fr: "3sDCmdSmtI4",
    en: "3sDCmdSmtI4",
    kh: "3sDCmdSmtI4"
  };

  const TITLES = {
    fr: "KHM TV Journal",
    en: "KHM TV Journal",
    kh: "KHM TV Journal"
  };

  const sel = document.getElementById("langSel");
  const frame = document.getElementById("ytFrame");
  const journalLink = document.getElementById("journalLink");
  const pageTitle = document.getElementById("pageTitle");

  const params = new URLSearchParams(location.search);
  const lang = params.get("lang") || localStorage.getItem("khm_lang") || "fr";
  const safeLang = (lang === "fr" || lang === "en" || lang === "kh") ? lang : "fr";

  function applyLang(v){
    localStorage.setItem("khm_lang", v);
    sel.value = v;
    pageTitle.textContent = TITLES[v];
    const id = VIDEO_ID[v];
    frame.src = "https://www.youtube-nocookie.com/embed/" + id + "?rel=0";
    journalLink.href = "journal.html?lang=" + v;
  }

  applyLang(safeLang);

  sel.addEventListener("change", () => {
    applyLang(sel.value);
    // Met √† jour l'URL sans recharger (propre)
    const u = new URL(location.href);
    u.searchParams.set("lang", sel.value);
    history.replaceState({}, "", u.toString());
  });

  // Bouton "Installer" (Android Chrome)
  let deferredPrompt = null;
  const installBtn = document.getElementById("installBtn");
  installBtn.style.display = "none";

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = "flex";
  });

  installBtn.addEventListener("click", async () => {
    if (!deferredPrompt) {
      alert("Sur Android: menu ‚ãÆ ‚Üí ‚ÄúAjouter √† l‚Äô√©cran d‚Äôaccueil‚Äù.");
      return;
    }
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBtn.style.display = "none";
  });
})();
</script>

  const sel = document.getElementById("langSel");
  const frame = document.getElementById("ytFrame");
  const journalLink = document.getElementById("journalLink");

  // 2) D√©terminer la langue (URL > localStorage > d√©faut)
  const params = new URLSearchParams(location.search);
  const lang = params.get("lang") || localStorage.getItem("khm_lang") || "fr";
  const safeLang = (lang === "fr" || lang === "en" || lang === "kh") ? lang : "fr";

  sel.value = safeLang;
  localStorage.setItem("khm_lang", safeLang);

  // 3) Appliquer l'iframe + le lien Journal
  const id = VIDEO_ID[safeLang];
  frame.src = "https://www.youtube-nocookie.com/embed/" + id + "?rel=0";
  journalLink.href = "journal.html?lang=" + safeLang;

  // 4) Changement de langue
  sel.addEventListener("change", () => {
    const v = sel.value;
    localStorage.setItem("khm_lang", v);
    location.search = "?lang=" + v; // recharge la page avec la langue
  });
})();
</script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/service-worker.js");
  }
</script>

</body>
</html>
